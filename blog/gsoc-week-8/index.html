<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> [GSoC 2016] CKEditor plugins - 8. week -Saša Nikolič </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="keywords" content="[GSoC 2016] CKEditor plugins - 8. week, Saša Nikolič, gsoc-2016,drupalplanet, gsoc, drupal, ckeditor plugins, translation"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Saša Nikolič" property="og:site_name" /> <meta content="[GSoC 2016] CKEditor plugins - 8. week" property="og:title" /> <meta content="article" property="og:type" /> <meta content="This is my window to the open internet world." property="og:description" /> <meta content="/blog/gsoc-week-8/" property="og:url" /> <meta content="2016-07-19T16:30:00+00:00" property="article:published_time" /> <meta content="/about/" property="article:author" /> <meta content="/assets/img/google-summer-of-code.png" property="og:image" /> <meta content="gsoc-2016" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="[GSoC 2016] CKEditor plugins - 8. week" /> <meta name="twitter:url" content="/blog/gsoc-week-8/" /> <meta name="twitter:description" content="This is my window to the open internet world." /> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = '' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- buy me a coffeee --> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sasanikolic90" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Saša Nikolič</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="/contact" >Contact</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="col-lg-12"> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">[GSoC 2016] CKEditor plugins - 8. week</h1> <h4 class="post-meta"></h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="/blog/authors/sasanikolic">sasanikolic</a></span> </span > at <time datetime="2016-07-19 16:30:00 +0000" itemprop="datePublished" >Jul 19, 2016</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/gsoc-week-8/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/gsoc-2016" >gsoc-2016</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="/assets/img/google-summer-of-code.png" alt="" /> <br /> <br /> <p>The eight week of my Google Summer of Code 2016 development process is over and the <a href="https://www.drupal.org/project/tmgmt">Translation Management module</a> for Drupal 8 is closer to becoming a much much better CAT tool than it ever was. My contribution to this project consists of developing CKEditor plugins for displaying pieces of content - segments, and masked tags inside them. Since we already passed the first midterm evaluation period, we are slowly but steadily moving forward the end goal of having a functional product that the open source community can use.</p> <p>Currently, I am working on the second plugin for masking <code class="language-plaintext highlighter-rouge">HTML tags</code> that are inside segments. The purpose of this plugin is to easily check the structure of the content and be warned of any missing or unclosed tags.</p> <h2 id="achievements">Achievements</h2> <p><a href="http://sasanikolic.com/gsoc-2016/gsoc-ckeditor-plugins-7-week/">Last week</a> I found some important blockers, which prevented me to make significant progress.</p> <p>I successfully managed to fix the one regarding the matching of segments containing masked tags. The idea behind the translation of segments is to get the active segment, together with the masked <code class="language-plaintext highlighter-rouge">HTML tags</code> inside it and make a <code class="language-plaintext highlighter-rouge">HTTP request</code> to the <a href="https://www.drupal.org/sandbox/edurenye/2715815">translation memory</a>. If one or more <em>perfect</em> matches are found, we display that as a suggestion and the user can then easily replace the text the chosen one. The main issue I faced here was the fact that the masking and unmasking of the tags was not yet supported by TMGMT. Together with the <em>MD Systems team</em> we worked on this part, and the final patch for <a href="https://www.drupal.org/node/2757813">this issue</a> should be committed soon. My mentors, <a href="https://www.drupal.org/u/miro_dietiker">Miro Dietiker</a> and <a href="https://www.drupal.org/u/berdir">Sascha Grossenbacher</a> were providing constant support and guidelines in finding the optimal solution.</p> <p>Once that was done, I could work on top of it and define a new workflow with one additional step:</p> <ol> <li>Masking the tags with TMGMT.</li> <li>Encode the masked tag before sending it through the HTTP request to the service controller.</li> <li>Unmask the tag.</li> <li>Query the segment with the unmasked tag in the translation memory.</li> <li>If we have a match, mask it and return it.</li> </ol> <p>Because the segments in the memory are not masked, we need to properly invoke the mask and unmask function the service controller. The problem here was that we cannot call alter hooks from my controller. As a quick solution, we provided them as simple external functions, which can then be called in the <code class="language-plaintext highlighter-rouge">hook_tmgmt_data_item_text_output_alter()</code> and <code class="language-plaintext highlighter-rouge">hook_tmgmt_data_item_text_input_alter()</code> hooks respectively to mask the tags on load and unmask on save, but also in the controller.</p> <p>The second issue that I stumbled upon last week was related to the closing tags. Since we defined our custom tag - <code class="language-plaintext highlighter-rouge">tmgmt-tag</code>, it needed to be added to the list of empty (self-closing) elements in the <code class="language-plaintext highlighter-rouge">CKEDITOR.dtd</code>object. This only solved the issue partially. Yes, the source in the editor shows the HTML structure completely right, but the DOM structure that the browser renders is still wrong. I found only <a href="http://stackoverflow.com/questions/29581028/problems-with-a-custom-self-closing-tag-in-ckeditor">one forum thread</a> on <em>stackoverflow</em> regarding the same issue. The solution would be to implement our <code class="language-plaintext highlighter-rouge">tmgmt-tag</code> as a widget. Regarding the CKEditor API, to do that, CKEditor 4.3 and above is needed and most importantly, the <a href="http://ckeditor.com/addon/widget">Widget plugin</a>, along with its dependencies. I tried to implement it, but it seems like that the widget plugin is not part of Drupal 8 yet.</p> <p>To solve this, I will follow my two options:</p> <ul> <li>contact the maintainers of the CKEditor for Drupal to get more info</li> <li>include it in my module</li> </ul> <p>Other than fixing last week’s issues, I created a new branch in my <a href="https://github.com/sasanikolic90/tmgmt_ckeditor/">Github repository</a> and started with refactoring. Based on my prototype <code class="language-plaintext highlighter-rouge">EditorPair</code>, I changed some functions to prototype methods. The idea here is that the functions should not access any data on the page, just do the logic. The prototype and its methods will be moved to a new file, so that the code would be accessible from both modules, <code class="language-plaintext highlighter-rouge">segments</code> and <code class="language-plaintext highlighter-rouge">tags</code>. After that, I would use some code review from my mentors here.</p> <h2 id="goals-for-next-week">Goals for next week</h2> <p>The main goal for this week is to fix the DOM structure and implement the widget for our custom tag. Once that is done, we can do some nice stuff, like capture clicks and move the tags around and display the data in their <code class="language-plaintext highlighter-rouge">raw</code> attribute. I also plan to do the validation of the masked tags. To begin with, a simple counter per segment will be added in both, source and translation editor. Each validation error will be per segment and will be displayed in the area below. I will also display exactly which tags are missing, so that the user gets a better idea which tags need to be added. More about it later in the followups.</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="/blog/gsoc-week-8/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Saša Nikolič </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="/assets/img/authors/sasa.png" alt="Saša Nikolič" /> </div> <div class="col-md-6"> <p class="author_bio">Web Developer. Occasionally, I write blogs and present publicly.</p> <p>Email : nikolic.sasa09@gmail.com</p> <p>Website : https://www.sasanikolic.com</p> <p class="profile-links"> <a class="social-link" href="https://github.com/sasanikolic90" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/saša-nikolič-62399992" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.facebook.com/sasanikolic123" target="_blank"><i class="fab fa-facebook fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/sasanikolic90" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> <a class="social-link" href="https://instagram.com/sasha.nklc" target="_blank"><i class="fab fa-instagram fa-fw"></i></a> </p> </div> </div> </div> </div> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "/blog/gsoc-week-8/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/gsoc-ckeditor-plugins-8-week"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://sasanikolic.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Saša Nikolič</div> <div class="card-body"> <p class="author_bio">I'm a Front-End Drupal Developer for MD Systems working remotely. I have serious passion for UI effects, animations and creating intuitive, dynamic user experiences. I love structure and order and I also stand for quality.</p> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#gsoc-2016"></div> <li class="tag-head"> <a href="/blog/categories/gsoc-2016">gsoc-2016</a> </li> <a name="gsoc-2016"></a> <div id="#paragraphs"></div> <li class="tag-head"> <a href="/blog/categories/paragraphs">paragraphs</a> </li> <a name="paragraphs"></a> <div id="#tech-2021"></div> <li class="tag-head"> <a href="/blog/categories/tech-2021">tech-2021</a> </li> <a name="tech-2021"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="/">Home</a> </li> <li> <a href="/about">About</a> </li> <li> <a href="/blog">Blog</a> </li> <li> <a href="/contact">Contact</a> </li> </div> </div> </div> </div> </div><footer> <p> Powered by <a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>. Subscribe via <a href=" /feed.xml ">RSS</a>.</p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
